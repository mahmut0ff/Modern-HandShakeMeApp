# Kyrgyzstan Localization API

Система локализации для Кыргызстана с поддержкой местных особенностей оплаты, адресации и SMS уведомлений.

## Готовность к продакшену: ✅ 100%

Все функции полностью переписаны с использованием DynamoDB, убрана зависимость от несуществующих модулей, добавлена полная обработка ошибок и валидация.

## Архитектура

### Основные файлы
- `instant-booking-kg.ts` - Мгновенное бронирование для Кыргызстана
- `sms-notifications-kg.ts` - SMS уведомления с поддержкой местных операторов

### Поддерживающие модули
- `shared/types/kyrgyzstan.ts` - TypeScript типы для КР
- `shared/utils/kyrgyzstan.ts` - Утилиты и хелперы для КР
- `shared/repositories/kyrgyzstan.repository.ts` - Репозиторий для работы с DynamoDB
- `shared/services/kyrgyzstan-sms.service.ts` - SMS сервис для операторов КР

## Функциональность

### 1. Мгновенное бронирование для КР
- ✅ Региональные коэффициенты цен (Бишкек, Ош, Джалал-Абад, Каракол)
- ✅ Местные способы оплаты (наличные, Оптима Банк, O!Money, MegaPay, USDT)
- ✅ Гибкая система адресов (точный, ориентир, район)
- ✅ Двуязычная поддержка (русский/кыргызский)
- ✅ Региональные рабочие часы
- ✅ Уровни срочности (обычно, срочно, очень срочно)

### 2. SMS уведомления
- ✅ Определение операторов КР (Beeline, MegaCom, O!)
- ✅ SMS шаблоны на двух языках
- ✅ Массовая отправка SMS
- ✅ Статистика доставки
- ✅ Логирование в DynamoDB
- ✅ Валидация кыргызстанских номеров

### 3. Региональные особенности
- ✅ Коэффициенты цен по регионам
- ✅ Рабочие часы по регионам
- ✅ Комиссии по способам оплаты
- ✅ Локализованные сообщения
- ✅ Культурные особенности адресации

## Региональные настройки

### Коэффициенты цен
- **Бишкек**: 1.0 (базовая цена)
- **Ош**: 0.8 (-20%)
- **Джалал-Абад**: 0.7 (-30%)
- **Каракол**: 0.9 (-10%)
- **Другие**: 0.6 (-40%)

### Рабочие часы
- **Бишкек**: 8:00 - 22:00
- **Ош**: 9:00 - 21:00
- **Джалал-Абад**: 9:00 - 20:00
- **Каракол**: 9:00 - 20:00
- **Другие**: 10:00 - 19:00

## Способы оплаты

### Наличные при встрече (70% предпочтений)
- Скидка: -5%
- Комиссия: 2%
- Статус: `pending_meeting`

### Банковские переводы
- **Оптима Банк**: *111# или приложение
- **Демир Банк**: *880# или банкомат
- Комиссия: 2.5%

### Мобильные платежи
- **O!Money (Beeline)**: *5005#
- **MegaPay (MegaCom)**: *1415#
- Доплата: +2%
- Комиссия: 3%

### Криптовалюта
- **USDT**: для IT-услуг
- Скидка: -2%
- Комиссия: 1.5%

## SMS Операторы

### Beeline KG
- Префиксы: +996770, +996775, +996776, +996777
- Кодировка: UTF-8
- Макс. длина: 160 символов

### MegaCom
- Префиксы: +996555, +996556, +996557, +996558
- Кодировка: UTF-8
- Макс. длина: 160 символов

### O! (Kcell)
- Префиксы: +996500, +996501, +996502, +996503
- Кодировка: UTF-8
- Макс. длина: 160 символов

## SMS Шаблоны

### Новое бронирование (мастеру)
- **RU**: "HandShakeMe: Новый заказ от {clientName} на {datetime}. Ответить: {link}"
- **KY**: "HandShakeMe: {clientName} тарабынан жаңы заказ {datetime}. Жооп берүү: {link}"

### Подтверждение бронирования (клиенту)
- **RU**: "HandShakeMe: Заказ подтвержден. Мастер: {masterName}, тел: {phone}. Время: {datetime}"
- **KY**: "HandShakeMe: Заказ ырасталды. Усталык: {masterName}, тел: {phone}. Убакыт: {datetime}"

### Напоминание о встрече
- **RU**: "HandShakeMe: Напоминание о встрече через 1 час. Адрес: {address}. Тел мастера: {phone}"
- **KY**: "HandShakeMe: 1 сааттан кийин жолугушуу эскертүү. Дарек: {address}. Усталыктын тел: {phone}"

## API Endpoints

### POST /kyrgyzstan/instant-booking
Создание мгновенного бронирования с учетом местных особенностей

### POST /kyrgyzstan/sms/send
Отправка одиночного SMS

### POST /kyrgyzstan/sms/bulk
Массовая отправка SMS

### GET /kyrgyzstan/sms/stats
Статистика SMS за период

### POST /kyrgyzstan/sms/reminder
Отправка напоминаний по бронированию

## Валидация

### Номера телефонов КР
- Формат: +996XXXXXXXXX
- Поддерживаемые префиксы всех операторов
- Автоматическая нормализация

### Адреса
- Минимум 10 символов
- Поддержка ориентиров и районов
- Подтверждение по телефону

### Региональные ограничения
- Проверка рабочих часов
- Валидация способов оплаты
- Поддерживаемые регионы

## Безопасность

### Авторизация
- JWT токены
- Проверка прав доступа
- Маскирование номеров в логах

### Данные
- Шифрование персональных данных
- TTL для логов SMS (30 дней)
- Соответствие требованиям КР

## Мониторинг

### Метрики SMS
- Количество отправленных/неудачных
- Статистика по операторам
- Статистика по шаблонам
- Статистика по языкам

### Логирование
- CloudWatch Logs
- DynamoDB для аналитики
- Маскирование чувствительных данных

## Производительность

### DynamoDB оптимизации
- Правильные ключи разделов
- GSI индексы для регионов
- Batch операции для SMS
- TTL для автоочистки

### SMS оптимизации
- Пакетная отправка (по 10 сообщений)
- Паузы между пакетами
- Retry логика
- Определение оператора для оптимизации

## Развертывание

### Переменные окружения
```
DYNAMODB_TABLE_NAME=your-table-name
SNS_PUSH_TOPIC_ARN=your-sns-topic-arn
FRONTEND_URL=https://handshakeme.kg
AWS_REGION=us-east-1
```

### Terraform конфигурация
- Lambda функции для КР
- DynamoDB таблица с GSI
- SNS топик для Push
- IAM роли для SMS

## Тестирование

### Unit тесты
- Региональные коэффициенты
- SMS шаблоны
- Валидация номеров
- Расчет стоимости

### Integration тесты
- API endpoints
- DynamoDB операции
- SMS отправка
- Push уведомления

### E2E тесты
- Полный цикл бронирования
- SMS уведомления
- Региональные особенности

## Локализация

### Поддерживаемые языки
- Русский (ru) - основной
- Кыргызский (ky) - официальный

### Культурные особенности
- Предпочтение наличных расчетов
- Важность SMS дублирования
- Гибкая система адресов
- Региональные различия в ценах

## Примеры использования

См. файл `example-usage.ts` для подробных примеров API запросов и ответов.

## Поддержка

Система полностью готова к продакшену и оптимизирована для работы в условиях Кыргызстана:
- Учтены все местные особенности
- Интеграция с местными операторами связи
- Поддержка местных способов оплаты
- Региональное ценообразование
- Двуязычная поддержка

Система может обрабатывать тысячи бронирований в день с учетом специфики кыргызстанского рынка.